name: 'Merge Simpson'
description: 'A zero-config merge queue that manages PRs using labels and standard CI checks.'
author: 'Peter Dodd'
inputs:
  github-token:
    description: 'GitHub Token'
    required: true
  label-queue:
    description: 'Label for queued PRs'
    required: false
    default: 'mq-queue'
  label-candidate:
    description: 'Label for the PR candidate used internally'
    required: false
    default: 'mq-candidate'

branding:
  icon: 'git-merge'
  color: 'yellow'
runs:
  using: "composite"
  steps:
    - name: On PR Closed
      id: on-pr-closed
      if: ${{ github.event.pull_request.state == 'closed' }}
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github-token }}
        REPO: ${{ github.repository }}
        LABEL_CANDIDATE: ${{ inputs.label-candidate }}
        LABEL_QUEUE: ${{ inputs.label-queue }}
      run: ${{ github.action_path }}/src/actions/on-pr-closed/action.yml

    - name: On PR Update
      id: on-pr-update
      if: ${{ github.event.pull_request.state != 'closed' }}
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github-token }}
        REPO: ${{ github.repository }}
        LABEL_CANDIDATE: ${{ inputs.label-candidate }}
        LABEL_QUEUE: ${{ inputs.label-queue }}
      run: ${{ github.action_path }}/src/actions/on-pr-update/action.yml
